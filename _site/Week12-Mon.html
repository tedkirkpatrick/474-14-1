<!DOCTYPE html>
<html lang="en">
	  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <!--<meta http-equiv="X-UA-Compatible" content="IE=edge">-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Web site for CMPT 474, Spring 2015">
    <meta name="author" content="A. E. Kirkpatrick">
    <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />

    <title>Logging (Week 12, Monday, March 31)</title>

    <!-- Bootstrap core CSS -->
    <link href="dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="http://getbootstrap.com/examples/navbar-static-top/navbar-static-top.css" rel="stylesheet">
    <link href="course.css" rel="stylesheet">
    <link href="dist/css/jquery.dataTables.css" rel="stylesheet">
    <link href="dist/css/jquery.dataTables_themeroller.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
  </head>


	<body>
		<div class="container">
			<div class="navbar navbar-default" role="navigation">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#collapse-id">
				<span class="sr-only">Toggle navigation</span>
		  		<span class="icon-bar"></span>
		  		<span class="icon-bar"></span>
		  		<span class="icon-bar"></span>
		  	</button>
			<a class="navbar-brand " href="index.html">CMPT 474</a>
		</div>
		<div class="collapse navbar-collapse" id="collapse-id">
			<ul class="nav navbar-nav">
				<li class="active"><a href="schedule.html">Schedule</a></li>
				<li ><a href="outcomes.html">Learning outcomes</a></li>
				<li ><a href="challenges.html">Challenges</a></li>
				<li ><a href="design.html">Design principles</a></li>
				<li ><a href="readings.html">Readings</a></li>
				
				<li ><a href="aws.html">AWS details</a></li>
				
		      </ul>
		</div>
	</div>
</div>

		</div>

		<div class="container ">
			<h1>Logging (Week 12, Monday, March 31)</h1>
		        
			<h2 id="logging-defined">Logging defined</h2>

<h3 id="basic-idea">Basic idea</h3>

<p>From <a href="https://docs.python.org/3/howto/logging.html#logging-basic-tutorial">Python 3 logging tutorial</a>:</p>

<p><code>python
logging.debug('This message should go to the log file')
logging.info('So should this')
logging.warning('And this, too')
</code></p>

<p><code>python
2010-12-12 11:41:42,612 DEBUG:root:This message should go to the log file
2010-12-12 11:41:43,015 INFO:root:So should this
2010-12-12 11:42:35,756 WARNING:root:And this, too
</code></p>

<ol>
  <li>When you record it?</li>
  <li>What information do you record?</li>
  <li>Do you have levels (DEBUG, INFO, WARNING)?</li>
  <li>When do you turn levels on and off?</li>
  <li>How do you analyze the logs?</li>
</ol>

<h3 id="when-do-you-use-it">When do you use it?</h3>

<p><small><a href="https://docs.python.org/3/howto/logging.html#logging-basic-tutorial">From Python 3 tutorial</a></small></p>

<table class="table">
<caption>When to use logging</caption>
<thead><tr><th scope="col">Task you want to perform</th><th scope="col">The best tool</th></tr>
</thead>
<tbody>
<tr><td>Display output for ordinary use of a command-line program</td><td><code>print()</code></td></tr>
<tr><td>Report events from normal operation</td><td><code>logging.info()</code> or <code>logging.debug()</code></td></tr>
<tr><td>Issue a warning regarding an event</td><td><code>logging.warning()</code> if there is nothing the application can do</td></tr>
<tr><td>Report an error from a specific event</td><td>Raise an exception</td></tr>
<tr><td>Report suppression of an error in a long-running process</td><td><code>logging.error()</code>, <code>logging.exception()</code>, or <code>logging.critical()</code>, as appropriate</td></tr>
</tbody>
</table>

<h3 id="importance-of-logging">Importance of logging</h3>

<p>From <a href="http://dl.acm.org.proxy.lib.sfu.ca/citation.cfm?id=2500468.2500475">20 Obstacles to Scalability</a>, p.&nbsp;58:</p>

<p>Number 7: Insufficient monitoring and metrics</p>

<ul>
  <li>&#8220;it should be so basic you cannot imagine working without it&#8221;</li>
</ul>

<p>Number 10: Insufficient logging</p>

<ul>
  <li>&#8220;You may enable a lot more of it when you are troubleshooting and debugging, but on an ongoing basis you will need it for key essential services&#8221;</li>
</ul>

<p>From <a href="site.data.bibliography.hamilton2007.url}}">On Designing and Deploying Internet-scale Services</a>, pp.&nbsp;231&#8211;232:</p>

<h2 id="log-everything-all-the-time">Log everything all the time</h2>
<p><small>From <a href="http://highscalability.com/blog/2007/8/30/log-everything-all-the-time.html">Log Everything All the Time</a>.</small></p>

<p>For highly-available applications</p>

<ul>
  <li>Log <strong>everything</strong></li>
  <li>Log <strong>all the time</strong></li>
  <li>Only have two levels, NORMAL and DEBUG</li>
  <li>Turn on debugging per-module</li>
  <li>
    <p>Every event should include the id of the customer request that started it:</p>

    <ul>
      <li>Customer S. Lee requested a resize of image &#8216;my-vacation-july-24-444.jpg&#8217; =&gt; Request <code>QX3567187</code></li>
    </ul>
  </li>
</ul>

<p><code>
2014-02-12 11:41:42,612 root:QX3567187:Resize from S. Lee of 'my-vacation-july-24-444.jpg' started
2014-02-12 11:41:43,015 root:QX3567187:Resize saved in S3 entry 'lee-mvj24-3617846.jpg'
2014-02-12 11:41:43,212 root:QX3567187:Resize sent to instance EC2-Q347HN for 100 by 100 resize
2014-02-12 11:42:35,756 root:QX3567187:Resize completed by EC2-Q347HN
</code></p>

<h3 id="keeping-it-efficient">Keeping it efficient</h3>

<p>Set up fast queue between high-priority worker process and low-priority logging process</p>

<ul>
  <li>Logging process does slower formatting operations</li>
  <li>Allocating/deallocating queue buffers must be fast</li>
  <li>Logger pushes to permanent storage in the background</li>
</ul>

<p>Any object should be easily dumped to the log</p>

<ul>
  <li><code>logging.dump(myobj)</code></li>
</ul>

<h2 id="analyzing-the-logs">Analyzing the logs</h2>

<p>Products such as
<a href="https://www.loggly.com/">loggly</a>
integrate logs from multiple sources and analyze them.</p>

<h2 id="guide-to-reading-for-next-class">Guide to reading for next class</h2>

<p><strong>Read the following two short sections from <a href="http://research.google.com/pubs/pub41344.html">F1: A Distributed Database that Scales</a>:</strong></p>

<ol>
  <li>
    <p>Section 1: Introduction (pp.&nbsp;1068&#8211;1069, not including &#8220;2. Basic Architecture&#8221;).</p>
  </li>
  <li>
    <p>Section 10: Latency and Throughput (p.&nbsp;1078, not including &#8220;11. Related Work&#8221;).</p>
  </li>
</ol>

<p>Key points: Most of the paper is concerned with database topics that are outside the scope of this course. However, the two sections I selected respond to two themes of the course:</p>

<ul>
  <li>The relation between scalability, availability, and latency. The F1 team claims to have found a unique design point in that space.</li>
  <li>Latency, replication, and distribution across data centres. The Paxos algorithm they mention is a quorum algorithm that requires a quorum of instances to be available in order to run. </li>
</ul>

		</div> <!-- /container -->

		    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="dist/js/jquery.dataTables.min.js"></script>
    <script src="dist/js/bootstrap.min.js"></script>
    
  

	</body>
</html>